name: Unittest

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

  steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-go@v3

    - name: Run unittests
      run: go test ./... -coverprofile=./cover.out -covermode=atomic -coverpkg=./...

    - name: Generate cover badge
      uses: vladopajic/go-test-coverage@v2
      with:
        profile: cover.out
        locale-prefix: github.com/gkits/sqlnull
        threshold-total: 95
        git-token: ${{ github.ref_name == 'main' && secrets.GITHUB_TOKEN || '' }}
        git-branch: badges
